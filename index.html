<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cài đặt Locket Gold</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Galaxy background -->
  <div class="galaxy-background"></div>

  <!-- Nhập key -->
  <div id="key-container" class="card">
    <h1>🔑 Nhập Key</h1>
    <p>Vui lòng nhập key để truy cập phần cài đặt</p>
    <input type="text" id="key-input" placeholder="Nhập key...">
    <button id="verify-btn" class="btn-verify">Xác nhận</button>
    <p id="error-msg"></p>
  </div>

  <!-- Phần cài đặt -->
  <div id="main-container" class="card">
    <h1>🚀 Cài đặt Locket Gold</h1>
    <p>Chào mừng! Bạn đã xác nhận key hợp lệ.</p>
    <a href="shadowrocket://install?module=https://raw.githubusercontent.com/junn-dev/locket-gold/main/junn.sgmodule" class="button btn-install">Cài Locket Ngay</a>
    <button id="download-config" class="btn-download">📥 Tải về Cấu Hình</button>
  </div>

<script>
const WORKER_URL = "https://locket-gold.hungnguyen-junn.workers.dev";

// Xác nhận key
async function verifyKey() {
  const key = document.getElementById("key-input").value.trim();
  const error = document.getElementById("error-msg");
  error.textContent = "";

  if (!key) { 
    error.textContent = "⚠️ Vui lòng nhập key!"; 
    return; 
  }

  try {
    const resp = await fetch(WORKER_URL + "/verify", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({key})
    });
    const data = await resp.json().catch(()=>({error:"Server không phản hồi"}));

    if (resp.ok && data.ok) {
      document.getElementById("key-container").style.display = "none";
      document.getElementById("main-container").style.display = "block";
    } else {
      error.textContent = data.error || "Key không hợp lệ!";
    }
  } catch(e){
    error.textContent = "Lỗi kết nối server!";
  }
}

// Tải file cấu hình
document.getElementById("download-config").addEventListener("click", ()=>{
  const link = document.createElement("a");
  link.href = "LocketJunn.mobileconfig"; // cùng thư mục project
  link.download = "LocketJunn.mobileconfig";
  link.click();
});

document.getElementById("verify-btn").addEventListener("click", verifyKey);

// Tạo galaxy stars nhẹ nhàng
document.addEventListener('DOMContentLoaded',()=>{
  const bg = document.querySelector('.galaxy-background');
  for(let i=0;i<100;i++){
    const s = document.createElement('div');
    s.className='star';
    s.style.width=s.style.height=(Math.random()*2+1)+'px';
    s.style.backgroundColor='white';
    s.style.opacity=Math.random();
    s.style.top=Math.random()*100+'%';
    s.style.left=Math.random()*100+'%';
    bg.appendChild(s);
  }
});
</script>

</body>
</html>
